

<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>1. Call Types &mdash; STKO Python API  documentation</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=80d5e7a1" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=e59714d7" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/custom.css?v=26ae5142" />

  
      <script src="../../_static/jquery.js?v=5d32c60e"></script>
      <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
      <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
      <script src="../../_static/doctools.js?v=9bcbadda"></script>
      <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="2. Basics" href="../2_basics/index.html" />
    <link rel="prev" title="PyMpc.Utils" href="../../_api/_modules/PyMpc.Utils.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html">
            
              <img src="../../_static/logo.png" class="logo" alt="Logo"/>
          </a>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">API Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../_api/index.html">Python API Reference</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Examples</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">1. Call Types</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#standard">1.1. Standard</a></li>
<li class="toctree-l2"><a class="reference internal" href="#process-events">1.2. Process events</a></li>
<li class="toctree-l2"><a class="reference internal" href="#working-thread">1.3. Working thread</a></li>
<li class="toctree-l2"><a class="reference internal" href="#working-thread-with-gui-operation-and-callback">1.4. Working thread with GUI-operation and callback</a></li>
<li class="toctree-l2"><a class="reference internal" href="#blocking-thread">1.5. Blocking thread</a></li>
<li class="toctree-l2"><a class="reference internal" href="#threadutils">1.6. ThreadUtils</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../2_basics/index.html">2. Basics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../3_objects/index.html">3. Objects</a></li>
<li class="toctree-l1"><a class="reference internal" href="../4_document/index.html">4. Document</a></li>
<li class="toctree-l1"><a class="reference internal" href="../5_mesh/index.html">5. Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../6_fiber-section/index.html">6. Fiber Section</a></li>
<li class="toctree-l1"><a class="reference internal" href="../7_cae-document/index.html">7. Cae document</a></li>
<li class="toctree-l1"><a class="reference internal" href="../8_post-processing/index.html">8. Post Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../9_application/index.html">9. Application</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">STKO Python API</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
      <li class="breadcrumb-item active">1. Call Types</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="call-types">
<h1>1. Call Types<a class="headerlink" href="#call-types" title="Link to this heading"></a></h1>
<p>Using Python within a Graphical User Interface (GUI) differs significantly from its typical usage in a console application,
requiring special considerations.</p>
<p>The following examples are not specific to PyMpc classes, functions, or methods,
but rather serve to illustrate various approaches to working with Python in the STKO interface.
Familiarity with GUI programming fundamentals can help unlock the full potential of the Python interface in STKO,
enabling you to write effective scripts both as a user and as a developer creating scripts for others.
This section provides a series of examples on call types, which are different methods for invoking processes from the GUI.</p>
<section id="standard">
<h2>1.1. Standard<a class="headerlink" href="#standard" title="Link to this heading"></a></h2>
<p>The first example demonstrates a standard call type with no additional setup.
To simulate a time-consuming operation, the <code class="docutils literal notranslate"><span class="pre">sleep</span></code> function is used.
Running this script will cause the GUI to freeze for 0.5 seconds when the <code class="docutils literal notranslate"><span class="pre">sleep</span></code> function is called.
In contrast, running this script from a console application would not freeze the visualization,
as the thread running the program is not responsible for generating a graphical interface.
Instead, it would execute sequentially, as expected.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>

<span class="nb">print</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
<span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;iteration </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Unlike console applications, GUIs do not run scripts from start to finish on a single thread.
Instead, they create an infinite loop called the event loop, which processes user interactions and updates the graphical interface.
When a standard call type is executed, it shares the same thread as the event loop.
As a result, if a function takes more than a second to complete, the STKO application will become unresponsive, appearing to freeze.
However, this does not indicate a crash; the application is simply busy executing the script and unable to update the GUI.</p>
<p>To effectively perform finite element analysis using <strong>Tcl</strong> or <strong>Python</strong>,
it is essential to understand the available commands in each scripting language,
as well as any new commands specific to the STKO interface.
Note that the <strong>Tcl</strong> and <strong>Python</strong> languages have distinct command sets,
which must be taken into account when scripting.</p>
</section>
<section id="process-events">
<h2>1.2. Process events<a class="headerlink" href="#process-events" title="Link to this heading"></a></h2>
<p>To prevent the GUI from freezing while running scripts, several approaches can be taken.
One of the simplest solutions is to utilize the <code class="docutils literal notranslate"><span class="pre">processEvents</span></code> method from the <a class="reference external" href="../../_api/_modules/PyMpc.App.html">App</a> sub-module.
This function enables the thread to divide its attention between the script and the GUI, allowing for more responsive interaction.</p>
<p>By inserting <code class="docutils literal notranslate"><span class="pre">processEvents</span></code> at the end of each iteration in the standard call type example,
you can now interact with the GUI while the script is running, although you may experience some lag.
This subtle feedback informs the user that the software is still operational, merely busy processing the script.
To see this in action, try running the following script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">PyMpc</span> <span class="kn">import</span> <span class="n">App</span>

<span class="nb">print</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;start&quot;</span><span class="p">)</span>
<span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
    <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;iteration </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span>
    <span class="n">App</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;end&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>By incorporating <code class="docutils literal notranslate"><span class="pre">processEvents</span></code>, you can create a more user-friendly experience,
even when running computationally intensive scripts.
This technique helps to maintain a responsive GUI,
providing reassurance that the software is functioning as intended.</p>
</section>
<section id="working-thread">
<h2>1.3. Working thread<a class="headerlink" href="#working-thread" title="Link to this heading"></a></h2>
<p>An alternative approach to prevent the GUI from freezing while running a process is to utilize a worker thread.
This requires leveraging the <a class="reference external" href="https://pypi.org/project/PySide2/">PySide2</a> library,
which is used to build the STKO GUI and is already installed on the Python embedded in STKO.
If you’re using a different Python environment,
you can install <a class="reference external" href="https://pypi.org/project/PySide2/">PySide2</a> by referring to the link provided.</p>
<p>To implement this approach, you’ll need to be familiar with Python concepts such as polymorphism,
child and parent classes, and inheritance. The example script below uses the same lengthy function as before,
but instead of calling it directly,
we create a Worker class that utilizes the signal and slot delivery mechanism provided by <a class="reference external" href="https://pypi.org/project/PySide2/">PySide2</a>.
This mechanism enables communication between objects by emitting signals when specific events occur,
which in turn trigger the execution of designated functions (slots).</p>
<p>For more information on signal and slot mechanisms,
please refer to the <a class="reference external" href="https://doc.qt.io/qtforpython/overviews/signalsandslots.html">Qt Documentation</a> or conduct your own research.</p>
<p>In the script below, we define a <strong>Worker</strong> class that includes a signal to notify the main thread when our process is complete.
Within this class, we define a run function tagged as a slot using the <em>&#64;</em> symbol,
which executes the lengthy function on a parallel worker thread.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">PySide2.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QObject</span><span class="p">,</span> <span class="n">Signal</span><span class="p">,</span> <span class="n">Slot</span><span class="p">,</span> <span class="n">QThread</span><span class="p">,</span> <span class="n">QEventLoop</span>

<span class="k">class</span> <span class="nc">Worker</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>
    <span class="n">finished</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>         <span class="c1">#signals</span>
    <span class="nd">@Slot</span><span class="p">()</span>                     <span class="c1">#lengthy function</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>              <span class="c1">#paste your function here, inside run...</span>

        <span class="nb">print</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;iteration </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>    <span class="c1"># Done</span>
</pre></div>
</div>
<p>y using a worker thread and the signal and slot delivery mechanism, we can decouple the GUI from the processing task,
ensuring a responsive and interactive user experience even when performing computationally intensive tasks.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">loop</span> <span class="o">=</span> <span class="n">QEventLoop</span><span class="p">()</span>

<span class="n">thread</span> <span class="o">=</span> <span class="n">QThread</span><span class="p">()</span>
<span class="n">worker</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">()</span>
<span class="n">worker</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>

<span class="n">worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">thread</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>
<span class="n">worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">)</span>
<span class="n">thread</span><span class="o">.</span><span class="n">started</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>
<span class="n">thread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">thread</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">)</span>
<span class="n">thread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">loop</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting thread...&#39;</span><span class="p">)</span>
<span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   Thread started&#39;</span><span class="p">)</span>

<span class="n">loop</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DONE!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>To ensure that the thread has completed its execution, it’s recommended to use the <code class="docutils literal notranslate"><span class="pre">exec_()</span></code> function from the QEventLoop class.
This function blocks the main thread until the event loop is finished, preventing potential crashes or errors in STKO.</p>
<p>When running the example script, you’ll notice that interacting with the STKO GUI is possible while the lengthy function is executing.
However, this flexibility also introduces a potential risk: if the user modifies the model while the script is running,
it may alter the data required by the script, leading to application crashes.
Similarly, if the same script is re-run before the first process has completed, it may also cause the application to crash.</p>
<p>To mitigate these risks, it’s essential to implement proper synchronization mechanisms, such as using event loops,
to ensure that the script execution is properly coordinated with the GUI interactions.
By doing so, you can prevent potential crashes and ensure a more robust and reliable user experience.</p>
<p>It’s worth noting that using event loops can help prevent common issues such as:</p>
<ul class="simple">
<li><p>Crashes caused by concurrent access to shared data</p></li>
<li><p>Errors resulting from incomplete or inconsistent data</p></li>
<li><p>Unexpected behavior due to concurrent execution of multiple scripts</p></li>
</ul>
<p>By incorporating event loops into your script design,
you can create more robust and reliable scripts that interact seamlessly with the STKO GUI.</p>
</section>
<section id="working-thread-with-gui-operation-and-callback">
<h2>1.4. Working thread with GUI-operation and callback<a class="headerlink" href="#working-thread-with-gui-operation-and-callback" title="Link to this heading"></a></h2>
<p>When working with GUI applications, it’s essential to remember that all GUI-related operations must be performed on the GUI thread.
This thread is responsible for listening to operating system events,
and attempting to perform GUI operations on a parallel thread can lead to crashes.</p>
<p>One common GUI operation is displaying a message box to communicate with the user and wait for input.
However, if you try to perform this operation on a parallel thread, your STKO application will likely crash.</p>
<p>To demonstrate this, let’s examine the following script,
which adds a GUI operation to the run function from the previous example.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">PySide2.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QObject</span><span class="p">,</span> <span class="n">Signal</span><span class="p">,</span> <span class="n">Slot</span><span class="p">,</span> <span class="n">QThread</span><span class="p">,</span> <span class="n">QEventLoop</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="n">QMessageBox</span>

<span class="k">class</span> <span class="nc">Worker</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>

    <span class="n">finished</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>

    <span class="nd">@Slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Title&quot;</span><span class="p">,</span> <span class="s2">&quot;Message: Hi there!&quot;</span><span class="p">)</span>

        <span class="nb">print</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;iteration </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">QEventLoop</span><span class="p">()</span>

<span class="n">thread</span> <span class="o">=</span> <span class="n">QThread</span><span class="p">()</span>
<span class="n">worker</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">()</span>
<span class="n">worker</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>

<span class="n">worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">thread</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>
<span class="n">worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">)</span>
<span class="n">thread</span><span class="o">.</span><span class="n">started</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>
<span class="n">thread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">thread</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">)</span>
<span class="n">thread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">loop</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting thread...&#39;</span><span class="p">)</span>
<span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   Thread started&#39;</span><span class="p">)</span>

<span class="n">loop</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DONE!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>As you can see, the script attempts to display a message box on a parallel thread,
which can cause the application to crash.</p>
<p>To avoid this issue, you can create a method within the Worker class that runs specific functions on the main thread.
One way to achieve this is by using a QBlockingSlot class, which is derived from QObject.
This class requests the call for a function and connects it to the parallel thread.</p>
<p>Here’s an updated script that demonstrates this approach:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">PySide2.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QObject</span><span class="p">,</span> <span class="n">Signal</span><span class="p">,</span> <span class="n">Slot</span><span class="p">,</span> <span class="n">QThread</span><span class="p">,</span> <span class="n">QEventLoop</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="n">QMessageBox</span><span class="p">,</span> <span class="n">QApplication</span>

<span class="k">class</span> <span class="nc">QBlockingSlot</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>
<span class="n">requestCall</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>
<span class="n">done</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>
<span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<span class="nb">super</span><span class="p">(</span><span class="n">QBlockingSlot</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">requestCall</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">function</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">done</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="n">loop</span> <span class="o">=</span> <span class="n">QEventLoop</span><span class="p">()</span>
<span class="bp">self</span><span class="o">.</span><span class="n">done</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">loop</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>
<span class="bp">self</span><span class="o">.</span><span class="n">requestCall</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
<span class="n">loop</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">runOnMainThread</span><span class="p">(</span><span class="n">what</span><span class="p">):</span>
<span class="n">bslot</span> <span class="o">=</span> <span class="n">QBlockingSlot</span><span class="p">(</span><span class="n">what</span><span class="p">)</span>
<span class="n">bslot</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">thread</span><span class="p">())</span>
<span class="n">bslot</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">Worker</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>

<span class="n">finished</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>

<span class="nd">@Slot</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="nb">print</span><span class="p">(</span><span class="n">QThread</span><span class="o">.</span><span class="n">currentThread</span><span class="p">())</span>
<span class="k">def</span> <span class="nf">what_to_run</span><span class="p">():</span>
<span class="nb">print</span><span class="p">(</span><span class="n">QThread</span><span class="o">.</span><span class="n">currentThread</span><span class="p">())</span>
<span class="nb">print</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">thread</span><span class="p">())</span>
<span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Hi There!&#39;</span><span class="p">)</span>
<span class="n">runOnMainThread</span><span class="p">(</span><span class="k">lambda</span> <span class="p">:</span> <span class="n">what_to_run</span><span class="p">())</span>

<span class="nb">print</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

<span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
<span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;iteration </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span>

<span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

<span class="n">loop</span> <span class="o">=</span> <span class="n">QEventLoop</span><span class="p">()</span>

<span class="n">thread</span> <span class="o">=</span> <span class="n">QThread</span><span class="p">()</span>
<span class="n">worker</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">()</span>
<span class="n">worker</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>

<span class="n">worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">thread</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>
<span class="n">worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">)</span>
<span class="n">thread</span><span class="o">.</span><span class="n">started</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>
<span class="n">thread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">thread</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">)</span>
<span class="n">thread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">loop</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting thread...&#39;</span><span class="p">)</span>
<span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   Thread started&#39;</span><span class="p">)</span>

<span class="n">loop</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DONE!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In this script, we create a QBlockingSlot class that allows us to run a function on the main thread.
We then use this class to display a message box on the main thread, while the parallel thread continues to run.</p>
<p>The print statements in the script show that the first call is different from the others,
and both the main and parallel threads are involved in the operations.
This demonstrates that we have successfully run a GUI operation on the main thread, while avoiding potential crashes.</p>
<p>By using this approach, you can ensure that your GUI applications remain stable and responsive,
even when performing complex operations on parallel threads.</p>
</section>
<section id="blocking-thread">
<h2>1.5. Blocking thread<a class="headerlink" href="#blocking-thread" title="Link to this heading"></a></h2>
<p>To ensure a seamless user experience, it’s essential to provide visual feedback when performing time-consuming operations.
One way to achieve this is by using a blocking dialog,
which prevents the user from interacting with the GUI while the operation is in progress.</p>
<p>In this example, we’ll modify the previous script to include a WorkerDialog class, derived from QDialog.
This dialog will display a progress bar and a label indicating that the operation is in progress.</p>
<p>The key difference between this approach and the previous one is that the dialog will remain visible until the operation is complete,
providing a clear indication of the progress.
Additionally, the dialog will not close when the user presses the button or the Escape key,
ensuring that the thread continues to run uninterrupted.</p>
<p>Here’s the updated script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">from</span> <span class="nn">PySide2.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QObject</span><span class="p">,</span> <span class="n">Signal</span><span class="p">,</span> <span class="n">Slot</span><span class="p">,</span> <span class="n">QThread</span><span class="p">,</span> <span class="n">QEventLoop</span><span class="p">,</span> <span class="n">QTimer</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="n">QMessageBox</span><span class="p">,</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">,</span> <span class="n">QLabel</span><span class="p">,</span> <span class="n">QProgressBar</span><span class="p">,</span> <span class="n">QVBoxLayout</span>

<span class="k">class</span> <span class="nc">QBlockingSlot</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>
    <span class="n">requestCall</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>
    <span class="n">done</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">function</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">QBlockingSlot</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requestCall</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function</span> <span class="o">=</span> <span class="n">function</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">function</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">done</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">call</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">loop</span> <span class="o">=</span> <span class="n">QEventLoop</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">done</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">loop</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">requestCall</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
        <span class="n">loop</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">runOnMainThread</span><span class="p">(</span><span class="n">what</span><span class="p">):</span>
    <span class="n">bslot</span> <span class="o">=</span> <span class="n">QBlockingSlot</span><span class="p">(</span><span class="n">what</span><span class="p">)</span>
    <span class="n">bslot</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">thread</span><span class="p">())</span>
    <span class="n">bslot</span><span class="o">.</span><span class="n">call</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">WorkerDialog</span><span class="p">(</span><span class="n">QDialog</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">parent</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>

        <span class="nb">super</span><span class="p">(</span><span class="n">WorkerDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">parent</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowFlags</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">Window</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">WindowTitleHint</span> <span class="o">|</span> <span class="n">Qt</span><span class="o">.</span><span class="n">CustomizeWindowHint</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAttribute</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">WA_DeleteOnClose</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setLayout</span><span class="p">(</span><span class="n">QVBoxLayout</span><span class="p">())</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="n">QLabel</span><span class="p">(</span><span class="s2">&quot;Work in progres. Please wait&quot;</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pbar</span> <span class="o">=</span> <span class="n">QProgressBar</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pbar</span><span class="o">.</span><span class="n">setRange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pbar</span><span class="o">.</span><span class="n">setTextVisible</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">layout</span><span class="p">()</span><span class="o">.</span><span class="n">addWidget</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pbar</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowOpacity</span><span class="p">(</span><span class="mf">0.0</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">QTimer</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">setInterval</span><span class="p">(</span><span class="mi">25</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onTimerTimeOut</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">showEvent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>

        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;showEvent&#39;</span><span class="p">)</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">WorkerDialog</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">showEvent</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">reject</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">pass</span>
<span class="nd">@Slot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">setPercentage</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">pbar</span><span class="o">.</span><span class="n">setValue</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
<span class="nd">@Slot</span><span class="p">()</span>
<span class="k">def</span> <span class="nf">onTimerTimeOut</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">&lt;</span> <span class="mf">1.0</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">delay</span> <span class="o">+=</span> <span class="mf">0.05</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setWindowOpacity</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">windowOpacity</span><span class="p">()</span> <span class="o">+</span> <span class="mf">0.05</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">windowOpacity</span><span class="p">()</span> <span class="o">==</span> <span class="mf">1.0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">stop</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">onTimerTimeOut</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Worker</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>
    <span class="n">sendPercentage</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">finished</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>

    <span class="nd">@Slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">QThread</span><span class="o">.</span><span class="n">currentThread</span><span class="p">())</span>
        <span class="k">def</span> <span class="nf">what_to_run</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">QThread</span><span class="o">.</span><span class="n">currentThread</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">thread</span><span class="p">())</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Hi There!&#39;</span><span class="p">)</span>
        <span class="n">runOnMainThread</span><span class="p">(</span><span class="k">lambda</span> <span class="p">:</span> <span class="n">what_to_run</span><span class="p">())</span>

        <span class="nb">print</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;iteration </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sendPercentage</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">10.0</span><span class="o">*</span><span class="mf">100.0</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>
</pre></div>
</div>
<p>As you can see, the WorkerDialog class is designed to display a progress bar and a label,
while also preventing the user from interacting with the GUI.
The showEvent method is overridden to start a timer that gradually increases the dialog’s opacity, creating a smooth fade-in effect.</p>
<p>The Worker class remains largely unchanged, with the addition of a sendPercentage signal that emits the progress percentage to the dialog.
This allows the dialog to update the progress bar accordingly.</p>
<p>The rest of the script is similar to the previous example,
with the addition of a new connection between the Worker and the WorkerDialog to send the progress percentage.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">dialog</span> <span class="o">=</span> <span class="n">WorkerDialog</span><span class="p">()</span>

<span class="n">thread</span> <span class="o">=</span> <span class="n">QThread</span><span class="p">()</span>
<span class="n">worker</span> <span class="o">=</span> <span class="n">Worker</span><span class="p">()</span>
<span class="n">worker</span><span class="o">.</span><span class="n">moveToThread</span><span class="p">(</span><span class="n">thread</span><span class="p">)</span>

<span class="n">worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">thread</span><span class="o">.</span><span class="n">quit</span><span class="p">)</span>
<span class="n">worker</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">)</span>
<span class="n">thread</span><span class="o">.</span><span class="n">started</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">worker</span><span class="o">.</span><span class="n">run</span><span class="p">)</span>
<span class="n">thread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">thread</span><span class="o">.</span><span class="n">deleteLater</span><span class="p">)</span>
<span class="n">worker</span><span class="o">.</span><span class="n">sendPercentage</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">setPercentage</span><span class="p">)</span>
<span class="n">thread</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">dialog</span><span class="o">.</span><span class="n">accept</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting thread...&#39;</span><span class="p">)</span>
<span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;   Thread started&#39;</span><span class="p">)</span>

<span class="n">dialog</span><span class="o">.</span><span class="n">exec_</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;DONE!&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>By using this approach, you can provide a more intuitive and user-friendly experience,
while also ensuring that the GUI remains responsive and stable.
This is the recommended way to interact with STKO from the Python API,
as it provides a clear indication of the progress and prevents the user from interacting with the GUI while the operation is in progress.</p>
</section>
<section id="threadutils">
<h2>1.6. ThreadUtils<a class="headerlink" href="#threadutils" title="Link to this heading"></a></h2>
<p>To simplify the process of running scripts with a blocking thread, we’ve created a utility file called ThreadUtils.py.
This file contains a set of classes and functions that can be used to run scripts with a blocking thread,
without having to repeat the same code in every script.</p>
<p>The ThreadUtils.py file includes the following classes and functions:</p>
<ul class="simple">
<li><p><strong>QBlockingSlot</strong>: a simple <code class="docutils literal notranslate"><span class="pre">QObject</span></code> that wraps a user-defined function and calls it, waiting for it to finish.</p></li>
<li><p><strong>runOnMainThread</strong>: a utility function that runs a function with a <code class="docutils literal notranslate"><span class="pre">QBlockingSlot</span></code> on the GUI thread.</p></li>
<li><p><strong>WorkerDialog</strong>: a simple worker dialog with a progress bar to track the percentage of an operation.</p></li>
<li><p><strong>runOnWorkerThread</strong>: a function that runs a worker (an instance of a class derived from <code class="docutils literal notranslate"><span class="pre">Worker</span></code>) on a working thread using the provided dialog.</p></li>
</ul>
<p>Here’s an example of using ThreadUtils in your script:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">importlib</span>
<span class="kn">import</span> <span class="nn">utils.ThreadUtils</span>
<span class="n">importlib</span><span class="o">.</span><span class="n">reload</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">ThreadUtils</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">utils.ThreadUtils</span> <span class="k">as</span> <span class="nn">tu</span>
<span class="kn">from</span> <span class="nn">PySide2.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QObject</span><span class="p">,</span> <span class="n">Signal</span><span class="p">,</span> <span class="n">Slot</span><span class="p">,</span> <span class="n">QThread</span>
<span class="kn">from</span> <span class="nn">PySide2.QtWidgets</span> <span class="kn">import</span> <span class="n">QMessageBox</span><span class="p">,</span> <span class="n">QApplication</span>

<span class="k">class</span> <span class="nc">Worker</span><span class="p">(</span><span class="n">QObject</span><span class="p">):</span>
    <span class="n">sendPercentage</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">finished</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">()</span>

    <span class="nd">@Slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">QThread</span><span class="o">.</span><span class="n">currentThread</span><span class="p">())</span>
        <span class="k">def</span> <span class="nf">what_to_run</span><span class="p">():</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">QThread</span><span class="o">.</span><span class="n">currentThread</span><span class="p">())</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span><span class="o">.</span><span class="n">thread</span><span class="p">())</span>
            <span class="n">QMessageBox</span><span class="o">.</span><span class="n">information</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span> <span class="s1">&#39;Title&#39;</span><span class="p">,</span> <span class="s1">&#39;Hi There!&#39;</span><span class="p">)</span>
        <span class="n">tu</span><span class="o">.</span><span class="n">runOnMainThread</span><span class="p">(</span><span class="k">lambda</span> <span class="p">:</span> <span class="n">what_to_run</span><span class="p">())</span>

        <span class="nb">print</span><span class="p">(</span><span class="vm">__file__</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">())</span>

        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">):</span>
            <span class="n">sleep</span><span class="p">(</span><span class="mf">0.5</span><span class="p">)</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;iteration </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">counter</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">sendPercentage</span><span class="o">.</span><span class="n">emit</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">)</span><span class="o">/</span><span class="mf">10.0</span><span class="o">*</span><span class="mf">100.0</span><span class="p">))</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span>

<span class="n">tu</span><span class="o">.</span><span class="n">runOnWorkerThread</span><span class="p">(</span><span class="n">Worker</span><span class="p">())</span>
</pre></div>
</div>
<p>In this example, we define a Worker class that inherits from QObject and has the necessary signals and slots.
We then use the runOnWorkerThread function from ThreadUtils to run the worker on a working thread, using the provided dialog.</p>
<p>Additionally, if you want to add exception handling to your function before emitting the signal to the thread that the process is finished,
you can use the IO sub-module, referenced in the Input/Output section.
Here’s an example:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
    <span class="n">IO</span><span class="o">.</span><span class="n">write_cerr</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ex</span><span class="p">))</span>
<span class="k">finally</span><span class="p">:</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">finished</span><span class="o">.</span><span class="n">emit</span><span class="p">()</span> <span class="c1"># Done</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024 Asdea Software.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>